---
sidebar: sidebar 
permalink: dbops/hybrid-dbops-snapcenter-dr.html 
summary: 採用SnapCenter DR 工作流程的混合雲資料庫解決方案 
keywords: 'netapp, solutions, database, SnapCenter, DR, "business continuity", "disaster recovery"' 
---
= 災難復原工作流程
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
企業已經將公有雲作為可行的資源和災難復原目的地。 SnapCenter使這個過程盡可能無縫。此災難復原工作流程與複製工作流程非常相似，但資料庫復原透過複製到雲端的最後一個可用日誌來還原所有可能的業務交易。但是，還有針對災難復原的額外預先配置和後配置步驟。



== 將本地 Oracle 生產資料庫複製到雲端以進行災難恢復

. 為了驗證克隆恢復是否通過最後一個可用日誌運行，我們創建了一個小測試表並插入了一行。完全恢復到最後可用日誌後，測試資料將被恢復。
+
image:snapctr-ora-dr-001.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 以 Oracle 資料庫管理使用者 ID 身分登入SnapCenter 。導覽至「資源」標籤，其中顯示受SnapCenter保護的 Oracle 資料庫。
+
image:snapctr-ora-dr-002.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇 Oracle 日誌資源群組並按一下「立即備份」以手動執行 Oracle 日誌備份，將最新交易刷新到雲端中的目標。在真實的 DR 場景中，最後一個可復原的交易取決於資料庫日誌磁碟區複製到雲端的頻率，而這又取決於公司的 RTO 或 RPO 策略。
+
image:snapctr-ora-dr-003.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+
image:snapctr-ora-dr-004.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+

NOTE: 在災難復原場景中，非同步SnapMirror會遺失在資料庫日誌備份間隔內未到達雲端目標的資料。為了最大限度地減少資料遺失，可以安排更頻繁的日誌備份。然而，從技術上來說，日誌備份頻率是有限制的。

. 選擇輔助鏡像備份上的最後一個日誌備份，並安裝該日誌備份。
+
image:snapctr-ora-dr-005.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+
image:snapctr-ora-dr-006.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇最後一個完整資料庫備份，然後按一下「克隆」以啟動克隆工作流程。
+
image:snapctr-ora-dr-007.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 在主機上選擇一個唯一的克隆資料庫 ID。
+
image:snapctr-ora-dr-008.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 為 Oracle 閃回復原區和線上日誌配置日誌磁碟區並將其掛載到目標 DR 伺服器。
+
image:snapctr-ora-dr-009.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+
image:snapctr-ora-dr-010.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+

NOTE: Oracle 克隆過程不會建立日誌卷，需要在克隆之前在 DR 伺服器上進行配置。

. 選擇目標複製主機和放置資料檔案、控制檔案和重做日誌的位置。
+
image:snapctr-ora-dr-011.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇克隆的憑證。填寫目標伺服器上 Oracle 主目錄配置的詳細資訊。
+
image:snapctr-ora-dr-012.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 指定克隆之前要執行的腳本。如果需要，可以調整資料庫參數。
+
image:snapctr-ora-dr-013.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇「直到取消」作為復原選項，以便恢復執行所有可用的存檔日誌來還原複製到輔助雲端位置的最後一個交易。
+
image:snapctr-ora-dr-014.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 如果需要，請設定 SMTP 伺服器以接收電子郵件通知。
+
image:snapctr-ora-dr-015.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. DR 克隆摘要。
+
image:snapctr-ora-dr-016.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 複製完成後，複製的資料庫會立即在SnapCenter中註冊，然後可用於備份保護。
+
image:snapctr-ora-dr-016-a.png["此圖顯示輸入/輸出對話框或表示書面內容"]





== Oracle 的災難復原後複製驗證與配置

. 驗證已在雲端中的 DR 位置刷新、複製和復原的最後一個測試交易。
+
image:snapctr-ora-dr-017.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 配置閃回恢復區。
+
image:snapctr-ora-dr-018.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 配置 Oracle 監聽器以供使用者存取。
. 將克隆卷從複製的來源卷中分離出來。
. 從雲端反向複製到本地並重建故障的本機資料庫伺服器。



NOTE: 克隆分裂可能會導致臨時儲存空間利用率遠高於正常運作。但重建本地DB伺服器後，可以釋放額外的空間。



== 將本機 SQL 生產資料庫複製到雲端以進行災難復原

. 類似地，為了驗證 SQL 克隆復原是否運行了最後一個可用日誌，我們建立了一個小型測試表並插入了一行。完全恢復到最後一個可用日誌後，測試資料將被恢復。
+
image:snapctr-sql-dr-001.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 使用 SQL Server 的資料庫管理使用者 ID 登入SnapCenter 。導覽至「資源」標籤，其中顯示 SQL Server 保護資源群組。
+
image:snapctr-sql-dr-002.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 手動執行日誌備份以刷新要複製到公有雲中的二級儲存的最後一個交易。
+
image:snapctr-sql-dr-003.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇最後一個完整的 SQL Server 備份進行複製。
+
image:snapctr-sql-dr-004.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 設定克隆設置，例如克隆伺服器、克隆實例、克隆名稱和掛載選項。執行克隆的輔助儲存位置是自動填入的。
+
image:snapctr-sql-dr-005.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 選擇要套用的所有日誌備份。
+
image:snapctr-sql-dr-006.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 指定克隆之前或之後運行的任何可選腳本。
+
image:snapctr-sql-dr-007.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 如果需要電子郵件通知，請指定 SMTP 伺服器。
+
image:snapctr-sql-dr-008.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. DR 克隆摘要。克隆的資料庫會立即在SnapCenter中註冊並可用於備份保護。
+
image:snapctr-sql-dr-009.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+
image:snapctr-sql-dr-010.png["此圖顯示輸入/輸出對話框或表示書面內容"]





== 災難復原後克隆 SQL 驗證和配置

. 監視克隆作業狀態。
+
image:snapctr-sql-dr-011.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 驗證最後一個交易是否已透過所有日誌檔案複製和復原進行複製和復原。
+
image:snapctr-sql-dr-012.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 在 DR 伺服器上設定新的SnapCenter日誌目錄以用於 SQL Server 日誌備份。
. 將克隆卷從複製的來源卷中分離出來。
. 從雲端反向複製到本地並重建故障的本機資料庫伺服器。




== 去哪裡尋求協助？

如果您需要有關此解決方案和用例的協助，請加入link:https://netapppub.slack.com/archives/C021R4WC0LC["NetApp解決方案自動化社群支援 Slack 頻道"]並尋找解決方案自動化管道來發布您的問題或詢問。
