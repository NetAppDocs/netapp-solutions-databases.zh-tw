---
sidebar: sidebar 
permalink: dbops/hybrid-dbops-sc-prereq-onprem.html 
summary: 本節所述的任務必須在本機上完成，以準備SnapCenter混合雲資料庫工作負載環境。 
keywords: prerequisites, on prem, on premises, installation, security, automation 
---
= 本地先決條件
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
必須在本機完成以下任務才能準備SnapCenter混合雲資料庫工作負載環境。



== SnapCenter安裝與配置

NetApp SnapCenter工具是一個基於 Windows 的應用程序，通常在 Windows 網域環境中運行，但也可以進行工作組部署。它基於多層架構，包括集中管理伺服器（ SnapCenter伺服器）和資料庫伺服器主機上用於資料庫工作負載的SnapCenter插件。以下是混合雲部署的一些關鍵考慮因素。

* *單一實例或 HA 部署。 *當單一SnapCenter實例伺服器發生故障時，HA 部署可提供冗餘。
* *名稱解析。 *必須在SnapCenter伺服器上設定 DNS 以解析所有資料庫主機，並在儲存 SVM 上配置 DNS 以進行正向和反向查找。也必須在資料庫伺服器上設定 DNS 來解析SnapCenter伺服器和儲存 SVM 的正向和反向查找。
* 基於角色的存取控制 (RBAC) 配置。 *對於混合資料庫工作負載，您可能想要使用 RBAC 來劃分不同資料庫平台的管理責任，例如 Oracle 資料庫的管理員或 SQL Server 的管理員。必須為資料庫管理員使用者授予必要的權限。
* *啟用基於策略的備份策略。 *強制備份的一致性和可靠性。
* *在防火牆上開啟必要的網路連接埠。 *供本機SnapCenter伺服器與安裝在雲端 DB 主機中的代理程式進行通訊。
* *必須開啟連接埠才能允許本地和公有雲之間的SnapMirror流量。 *  SnapCenter伺服器依賴ONTAP SnapMirror將現場 Snapshot 備份複製到雲端 CVO 儲存 SVM。


經過仔細的安裝前規劃和考慮後，請點擊此處link:https://docs.netapp.com/us-en/snapcenter/install/requirements-to-install-snapcenter-server.html["SnapCenter安裝前提條件"^]有關SnapCenter安裝和配置的詳細資訊。



== 本地資料庫伺服器儲存配置

儲存效能對資料庫和應用程式的整體效能起著重要作用。精心設計的儲存佈局不僅可以提高資料庫效能，還可以方便管理資料庫備份和復原。定義儲存佈局時應考慮幾個因素，包括資料庫的大小、資料庫預期的資料變化率以及執行備份的頻率。

對於虛擬化資料庫工作負載，透過 NFS 或 iSCSI 將儲存 LUN 直接連接到客戶虛擬機器通常比透過 VMDK 分配的儲存提供更好的效能。  NetApp建議在下圖所示的 LUN 上對大型 SQL Server 資料庫採用儲存佈局。

image:storage-layout-sqlsvr-large.png["此圖顯示輸入/輸出對話框或表示書面內容"]

下圖顯示了NetApp針對 LUN 上的小型或中型 SQL Server 資料庫所建議的儲存佈局。

image:storage-layout-sqlsvr-smallmedium.png["此圖顯示輸入/輸出對話框或表示書面內容"]


NOTE: 日誌目錄專用於SnapCenter ，用於執行資料庫復原的交易日誌總計。對於超大型資料庫，可以將多個 LUN 指派給一個磁碟區以獲得更好的效能。

對於 Oracle 資料庫工作負載， SnapCenter支援由ONTAP儲存支援的資料庫環境，這些儲存體會作為實體或虛擬設備安裝到主機。您可以根據環境的關鍵性將整個資料庫託管在一個或多個儲存裝置上。通常，客戶會將專用儲存上的資料檔案與所有其他檔案（例如控製檔案、重做檔案和存檔日誌檔案）隔離。這有助於管理員在幾秒鐘到幾分鐘內使用 Snapshot 技術快速復原（ONTAP單一檔案SnapRestore）或複製大型關鍵資料庫（PB 級）。

image:storage-layout-oracle-typical.png["此圖顯示輸入/輸出對話框或表示書面內容"]

對於對延遲敏感的關鍵任務工作負載，應將專用儲存磁碟區部署到不同類型的 Oracle 文件，以實現最佳延遲。對於大型資料庫，每個磁碟區應為資料檔案分配多個 LUN（NetApp建議最多八個）。

image:storage-layout-oracle-dedicated.png["此圖顯示輸入/輸出對話框或表示書面內容"]

對於較小的 Oracle 資料庫， SnapCenter支援共享儲存佈局，您可以在同一個儲存磁碟區或 LUN 上託管多個資料庫或部分資料庫。作為此佈局的範例，您可以在 +DATA ASM 磁碟組或磁碟區組上託管所有資料庫的資料檔案。其餘檔案（重做、存檔日誌和控制檔案）可以託管在另一個專用磁碟組或磁碟區組（LVM）上。此類部署場景如下所示。

image:storage-layout-oracle-shared.png["此圖顯示輸入/輸出對話框或表示書面內容"]

為了方便 Oracle 資料庫的重新定位，Oracle 二進位檔案應安裝在包含在常規備份原則中的單獨 LUN 上。這確保了在將資料庫遷移到新的伺服器主機時，可以啟動 Oracle 堆疊進行恢復，而不會因 Oracle 二進位檔案不同步而出現任何潛在問題。



== 許可要求

SnapCenter是NetApp授權的軟體。它通常包含在本地ONTAP許可證中。但是，對於混合雲部署，還需要SnapCenter的雲端授權才能將 CVO 新增至SnapCenter作為目標資料複製目的地。請查看以下連結以了解SnapCenter標準容量許可證的詳細資訊：

link:https://docs.netapp.com/us-en/snapcenter/install/concept_snapcenter_standard_controller_based_licenses.html["SnapCenter標準容量許可證"^]



== 網路和安全

在混合資料庫操作中，需要將本地生產資料庫突發傳輸到雲端以進行開發/測試和災難恢復，在設定環境並從本地資料中心連接到公有雲時，網路和安全是需要考慮的重要因素。

公有雲通常使用虛擬私有雲 (VPC) 來隔離公有雲平台內的不同使用者。在單一 VPC 內，使用可根據使用者對 VPC 鎖定的需求配置的安全群組等措施來控制安全性。

可透過 VPN 隧道保護從本機資料中心到 VPC 的連線。在 VPN 閘道上，可以使用 NAT 和防火牆規則來加強安全性，並阻止從網際網路上的主機到公司資料中心內的主機建立網路連線的嘗試。

基於網路和安全性方面的考慮，請查看您選擇的公有雲的相關入站和出站 CVO 規則：

* link:https://docs.netapp.com/us-en/occm/reference_security_groups.html#inbound-rules["CVO 的安全群組規則 - AWS"]
* link:https://docs.netapp.com/us-en/occm/reference_networking_azure.html#outbound-internet-access["CVO 的安全群組規則 - Azure"]
* link:https://docs.netapp.com/us-en/occm/reference_networking_gcp.html#outbound-internet-access["CVO - GCP 的防火牆規則"]




== 使用 Ansible 自動化在本地和雲端之間同步資料庫執行個體 - 可選

為了簡化混合雲端資料庫環境的管理， NetApp強烈建議但不要求您部署 Ansible 控制器來自動執行某些管理任務，例如保持本機和雲端中的運算執行個體同步。這一點尤其重要，因為雲端中不同步的運算實例可能會因缺少核心包和其他問題而導致雲端中復原的資料庫容易出錯。

Ansible 控制器的自動化功能也可用於增強SnapCenter 的某些任務，例如分解SnapMirror執行個體以啟動生產的 DR 資料副本。

請依照以下說明為 RedHat 或 CentOS 機器設定 Ansible 控制節點：

. Ansible 控制節點的要求：
+
.. 安裝了以下軟體包的 RHEL/CentOS 機器：
+
... Python3
... Pip3
... Ansible（版本高於 2.10.0）
... Git






如果您有一台新的 RHEL/CentOS 機器，但沒有安裝上述要求，請依照下列步驟將機器設定為 Ansible 控制節點：

. 為 RHEL-8/RHEL-7 啟用 Ansible 儲存庫
+
.. 對於 RHEL-8（以 root 身分執行以下命令）
+
[source, cli]
----
subscription-manager repos --enable ansible-2.9-for-rhel-8-x86_64-rpms
----
.. 對於 RHEL-7（以 root 身分執行以下命令）
+
[source, cli]
----
subscription-manager repos --enable rhel-7-server-ansible-2.9-rpms
----


. 將以下內容貼到終端機中
+
[source, cli]
----
sudo yum -y install python3 >> install.log
sudo yum -y install python3-pip >> install.log
python3 -W ignore -m pip --disable-pip-version-check install ansible >> install.log
sudo yum -y install git >> install.log
----


請依照以下說明為 Ubuntu 或 Debian 機器設定 Ansible 控制節點：

. Ansible 控制節點的要求：
+
.. 安裝了以下軟體包的 Ubuntu/Debian 機器：
+
... Python3
... Pip3
... Ansible（版本高於 2.10.0）
... Git






如果您有一台新的 Ubuntu/Debian 機器，但沒有安裝上述要求，請按照以下步驟將機器設定為 Ansible 控制節點：

. 將下面的內容貼到終端機中
+
[source, cli]
----
sudo apt-get -y install python3 >> outputlog.txt
sudo apt-get -y install python3-pip >> outputlog.txt
python3 -W ignore -m pip --disable-pip-version-check install ansible >> outputlog.txt
sudo apt-get -y install git >> outputlog.txt
----

