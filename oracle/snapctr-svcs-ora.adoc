---
sidebar: sidebar 
permalink: oracle/snapctr-svcs-ora.html 
keywords: Oracle, Database, SnapCenter, SnapShot, FlexClone, BlueXP, Database Backup, Database Restore, Database Clone 
summary: 此解決方案提供了使用 Azure 雲端中的BlueXP控制台使用NetApp SnapCenter SaaS 進行 Oracle 資料庫備份、復原和複製的概述和詳細資訊。 
---
= TR-4964：使用SnapCenter服務備份、還原和克隆 Oracle 資料庫 - AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
此解決方案提供了使用 Azure 雲端中的BlueXP控制台使用NetApp SnapCenter SaaS 進行 Oracle 資料庫備份、復原和複製的概述和詳細資訊。

Allen Cao、Niyaz Mohamed， NetApp



== 目的

SnapCenter Services 是經典SnapCenter資料庫管理 UI 工具的 SaaS 版本，可透過NetApp BlueXP雲端管理控制台使用。它是NetApp雲端備份、資料保護產品的重要組成部分，適用於在NetApp雲端儲存上執行的 Oracle 和 HANA 等資料庫。這項基於 SaaS 的服務簡化了傳統的SnapCenter獨立伺服器部署，該部署通常需要在 Windows 網域環境中執行的 Windows 伺服器。

在本文檔中，我們示範如何設定SnapCenter服務來備份、還原和複製部署到Amazon FSx ONTAP儲存和 EC2 運算執行個體的 Oracle 資料庫。儘管設定和使用起來更容易，但SnapCenter服務提供了舊版SnapCenter UI 工具中可用的關鍵功能。

此解決方案適用於以下用例：

* 使用快照對Amazon FSx ONTAP中託管的 Oracle 資料庫進行資料庫備份
* Oracle資料庫故障時的復原
* 為開發/測試環境或其他用例快速且有效率地複製主資料庫




== 對象

此解決方案適用於以下受眾：

* 管理在Amazon FSx ONTAP儲存上執行的 Oracle 資料庫的 DBA
* 有興趣在公有 AWS 雲端中測試 Oracle 資料庫備份、復原和複製的解決方案架構師
* 支援和管理Amazon FSx ONTAP儲存的儲存管理員
* 擁有部署到Amazon FSx ONTAP儲存的應用程式的應用程式擁有者




== 解決方案測試和驗證環境

此解決方案的測試和驗證是在可能與最終部署環境不符的 AWS FSx 和 EC2 環境中進行的。有關更多信息，請參閱<<部署考慮的關鍵因素>> 。



=== 架構

image:snapctr-svcs-architecture.png["此圖提供了BlueXP控制台內應用程式的BlueXP backup and recovery的詳細圖片，包括其管理的 UI、連接器和資源。"]

此圖提供了BlueXP控制台內應用程式的BlueXP backup and recovery的詳細圖片，包括 UI、連接器及其管理的資源。



=== 硬體和軟體組件

*硬體*

[cols="33%, 33%, 33%"]
|===


| FSx ONTAP存儲 | AWS 提供的目前版本 | 同一 VPC 和可用區中的一個 FSx HA 集群 


| 用於計算的 EC2 實例 | t2.xlarge/4vCPU/16G | 兩個 EC2 T2 xlarge EC2 實例，一個作為主資料庫伺服器，另一個作為克隆資料庫伺服器 
|===
*軟體*

[cols="33%, 33%, 33%"]
|===


| 紅帽Linux | RHEL-8.6.0_HVM-20220503-x86_64-2-Hourly2-GP2 | 部署 RedHat 訂閱進行測試 


| Oracle 網格基礎架構 | 版本 19.18 | 已套用RU補丁p34762026_190000_Linux-x86-64.zip 


| Oracle 資料庫 | 版本 19.18 | 已套用RU補丁p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | 版本 12.2.0.1.36 | 最新補丁 p6880880_190000_Linux-x86-64.zip 


| SnapCenter服務 | 版本 | v2.3.1.2324 
|===


=== 部署考慮的關鍵因素

* *連接器將與資料庫和 FSx 部署在同一個 VPC 中。 *如果可能，連接器應部署在同一個 AWS VPC 中，以便能夠連接到 FSx 儲存和 EC2 運算執行個體。
* *為SnapCenter連接器建立的 AWS IAM 原則。 * JSON 格式的政策可在詳細的SnapCenter服務文件中找到。當您使用BlueXP控制台啟動連接器部署時，系統也會提示您設定先決條件，並以 JSON 格式提供所需權限的詳細資訊。此政策應指派給擁有連接器的 AWS 使用者帳戶。
* *AWS 帳戶存取金鑰和在 AWS 帳戶中建立的 SSH 金鑰對。 * SSH 金鑰對指派給 ec2-user，用於登入連接器主機，然後將資料庫插件部署到 EC2 DB 伺服器主機。存取金鑰授予使用上述 IAM 政策配置所需連接器的權限。
* *已將憑證新增至BlueXP控制台設定。 *若要將Amazon FSx ONTAP新增至BlueXP工作環境，需要在BlueXP控制台設定中設定授予BlueXP存取Amazon FSx ONTAP 的權限的憑證。
* *java-11-openjdk 安裝在 EC2 資料庫執行個體主機上。 * SnapCenter服務安裝需要 Java 版本 11。在嘗試部署插件之前，需要在應用程式主機上安裝它。




== 解決方案部署

NetApp擁有大量內容更豐富的文檔，可協助您保護雲端原生應用程式資料。本文檔的目標是提供逐步程序，涵蓋使用BlueXP控制台部署SnapCenter服務，以保護部署到Amazon FSx ONTAP和 EC2 運算執行個體的 Oracle 資料庫。本文檔補充了一般說明中可能缺少的某些細節。

首先，請完成以下步驟：

* 閱讀一般說明link:https://docs.netapp.com/us-en/bluexp-backup-recovery/["保護您的雲端原生應用程式數據"^]以及與 Oracle 和Amazon FSx ONTAP相關的部分。
* 觀看以下影片示範。


.解決方案部署
video::4b0fd212-7641-46b8-9e55-b01200f9383a[panopto]


=== SnapCenter服務部署的先決條件

[%collapsible%open]
====
部署需要以下先決條件。

. EC2 執行個體上的主 Oracle 資料庫伺服器，其中已完全部署並正在執行 Oracle 資料庫。
. 在 AWS 中部署的Amazon FSx ONTAP集群，託管上述資料庫磁碟區。
. EC2 執行個體上的選用資料庫伺服器，可用於測試將 Oracle 資料庫複製到備用主機，以支援開發/測試工作負載或任何需要生產 Oracle 資料庫完整資料集的用例。
. 如果您需要協助以滿足在Amazon FSx ONTAP和 EC2 運算執行個體上部署 Oracle 資料庫的上述先決條件，請參閱link:aws-ora-fsx-ec2-iscsi-asm.html["使用 iSCSI/ASM 在 AWS FSx/EC2 中部署和保護 Oracle 資料庫"^]或白皮書link:aws-ora-fsx-ec2-deploy-intro.html["EC2 和 FSx 上的 Oracle 資料庫部署最佳實踐"^]


====


=== 加入BlueXP 的準備

[%collapsible%open]
====
. 使用連結link:https://console.bluexp.netapp.com/["NetApp BlueXP"]註冊BlueXP控制台存取。
. 登入您的 AWS 帳戶以建立具有適當權限的 IAM 政策，並將該政策指派給將用於BlueXP連接器部署的 AWS 帳戶。
+
image:snapctr-svcs-connector-001-policy.png["螢幕截圖顯示了 GUI 中的此步驟。"]

+
此策略應使用NetApp文件中提供的 JSON 字串進行配置。當啟動連接器設定並提示您指派先決條件權限時，也可以從頁面中擷取 JSON 字串。

. 您還需要 AWS VPC、子網路、安全群組、AWS 使用者帳戶存取金鑰和機密、ec2-user 的 SSH 金鑰等，以準備好連接器設定。


====


=== 為SnapCenter服務部署連接器

[%collapsible%open]
====
. 登入BlueXP控制台。對於共用帳戶，最佳做法是透過點擊 *帳戶* > *管理帳戶* > *工作區* 來新增新的工作區，從而建立單獨的工作區。
+
image:snapctr-svcs-connector-002-wspace.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 按一下「*新增連接器*」以啟動連接器設定工作流程。


image:snapctr-svcs-connector-003-add.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇您的雲端提供者（在本例中為*Amazon Web Services*）。


image:snapctr-svcs-connector-004-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 如果您已經在 AWS 帳戶中設定了*權限*、*身份驗證*和*網路*步驟，請跳過這些步驟。如果沒有，您必須先配置這些才能繼續。從這裡，您還可以檢索上一節中引用的 AWS 策略的權限“<<加入BlueXP 的準備>> “


image:snapctr-svcs-connector-005-remind.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 使用 *存取金鑰* 和 *金鑰* 輸入您的 AWS 帳戶驗證。
+
image:snapctr-svcs-connector-006-auth.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 命名連接器實例並選擇*詳細資料*下的*建立角色*。


image:snapctr-svcs-connector-007-details.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 使用適當的 *VPC*、*Subnet* 和 SSH *Key Pair* 設定網路以進行連接器存取。
+
image:snapctr-svcs-connector-008-network.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 為連接器設定*安全群組*。
+
image:snapctr-svcs-connector-009-security.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 查看摘要頁面並點擊“*新增*”以開始建立連接器。部署完成一般需10分鐘左右。完成後，連接器執行個體將出現在 AWS EC2 儀表板中。


image:snapctr-svcs-connector-010-review.png["螢幕截圖顯示了 GUI 中的此步驟。"]

====


=== 在BlueXP中定義憑證以存取 AWS 資源

[%collapsible%open]
====
. 首先，從 AWS EC2 控制台，在 *身分和存取管理 (IAM)* 選單 *角色*、*建立角色* 中建立一個角色，以啟動角色建立工作流程。
+
image:snapctr-svcs-credential-001-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 在*選擇受信任實體*頁面中，選擇*AWS 帳戶*、*另一個 AWS 帳號*，然後貼上BlueXP帳號 ID，該 ID 可從BlueXP控制台擷取。
+
image:snapctr-svcs-credential-002-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 透過 fsx 過濾權限策略並將*權限策略*新增至角色。
+
image:snapctr-svcs-credential-003-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 在*角色詳情*頁面中，命名角色，新增描述，然後按一下*建立角色*。
+
image:snapctr-svcs-credential-004-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 返回BlueXP控制台，點選控制台右上角的設定圖示開啟 *帳戶憑證* 頁面，點選 *新增憑證* 啟動憑證設定工作流程。
+
image:snapctr-svcs-credential-005-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇憑證位置為 - *Amazon Web Services - BlueXP*。
+
image:snapctr-svcs-credential-006-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 使用適當的*角色 ARN*定義 AWS 憑證，可以從上述第一步驟建立的 AWS IAM 角色中檢索。  BlueXP *帳戶 ID*，用於在第一步驟建立 AWS IAM 角色。
+
image:snapctr-svcs-credential-007-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 審查並*添加*。image:snapctr-svcs-credential-008-aws.png["螢幕截圖顯示了 GUI 中的此步驟。"]


====


=== SnapCenter服務設定

[%collapsible%open]
====
部署連接器並新增憑證後，現在可以按照下列步驟設定SnapCenter服務：

. 從*我的工作環境*點擊*新增工作環境*以發現部署在 AWS 中的 FSx。


image:snapctr-svcs-setup-001.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇*Amazon Web Services*作為位置。


image:snapctr-svcs-setup-002.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 按一下 * Amazon FSx ONTAP* 旁的 *發現現有*。


image:snapctr-svcs-setup-003.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇您在上一節中建立的 *Credentials Name*，以授予BlueXP管理 FSx ONTAP所需的權限。如果您尚未新增憑證，您可以從BlueXP控制台右上角的「設定」功能表中新增。
+
image:snapctr-svcs-setup-004.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇部署Amazon FSx ONTAP 的AWS 區域，選擇託管 Oracle 資料庫的 FSx 集群，然後按一下新增。


image:snapctr-svcs-setup-005.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 發現的Amazon FSx ONTAP實例現在出現在工作環境中。


image:snapctr-svcs-setup-006.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 您可以使用 fsxadmin 帳戶憑證登入 FSx 叢集。


image:snapctr-svcs-setup-007.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 登入Amazon FSx ONTAP後，檢查資料庫儲存資訊（例如資料庫磁碟區）。


image:snapctr-svcs-setup-008.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 從控制台左側邊欄，將滑鼠懸停在保護圖示上，然後點擊*保護*>*應用程式*以開啟應用程式啟動頁面。點擊“發現應用程式”。


image:snapctr-svcs-setup-009.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇“Cloud Native”作為應用程式來源類型。


image:snapctr-svcs-setup-010.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇*Oracle*作為應用程式類型。


image:snapctr-svcs-setup-013.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 填寫 AWS EC2 Oracle 應用程式主機詳細資訊。選擇*使用 SSH*作為*主機安裝類型*，以進行一步插件安裝和資料庫發現。然後，點擊*新增 SSH 私鑰*。
+
image:snapctr-svcs-setup-014.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 貼上資料庫 EC2 主機的 ec2-user SSH 金鑰，然後按一下 *驗證* 繼續。
+
image:snapctr-svcs-setup-014-a.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 系統將提示您「驗證指紋」以繼續。
+
image:snapctr-svcs-setup-014-b.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 按一下「*下一步*」安裝 Oracle 資料庫外掛程式並發現 EC2 主機上的 Oracle 資料庫。發現的資料庫被加入到*應用程式*。最初發現時，資料庫*保護狀態*顯示為*不受保護*。
+
image:snapctr-svcs-setup-017.png["螢幕截圖顯示了 GUI 中的此步驟。"]



這完成了 Oracle 的SnapCenter服務的初始設定。本文檔接下來的三節介紹 Oracle 資料庫的備份、復原和複製作業。

====


=== Oracle資料庫備份

[%collapsible%open]
====
. 按一下資料庫*保護狀態*旁邊的三個點，然後按一下*策略*以查看可套用來保護 Oracle 資料庫的預設預先載入資料庫保護策略。


image:snapctr-svcs-bkup-001.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 您也可以建立自己的策略，自訂備份頻率和備份資料保留視窗。


image:snapctr-svcs-bkup-002.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 當您對策略配置感到滿意時，您可以指派您選擇的策略來保護資料庫。


image:snapctr-svcs-bkup-003.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇要指派給資料庫的策略。


image:snapctr-svcs-bkup-004.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 套用原則後，資料庫保護狀態變成*受保護*，並有綠色複選標記。


image:snapctr-svcs-bkup-005.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 資料庫備份按照預定的時間表運行。您也可以執行一次性按需備份，如下所示。


image:snapctr-svcs-bkup-006.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 可以透過點擊選單清單中的「查看詳細資料」來查看資料庫備份詳細資訊。這包括備份名稱、備份類型、SCN 和備份日期。備份集涵蓋資料捲和日誌卷的快照。日誌卷快照在資料庫磁碟區快照之後立即發生。如果您要在長列表中尋找特定的備份，則可以套用篩選器。


image:snapctr-svcs-bkup-007.png["螢幕截圖顯示了 GUI 中的此步驟。"]

====


=== Oracle 資料庫還原與復原

[%collapsible%open]
====
. 對於資料庫恢復，請選擇正確的備份，可以透過 SCN 或備份時間。按一下資料庫資料備份中的三個點，然後按一下*還原*以啟動資料庫復原和復原。


image:snapctr-svcs-restore-001.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 選擇您的恢復設定。如果您確定備份後實體資料庫結構沒有任何變更（例如新增了資料檔案或磁碟組），則可以使用*強制就地還原*選項，這通常速度更快。否則，請不要選取此方塊。


image:snapctr-svcs-restore-002.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 審查並開始資料庫還原和復原。


image:snapctr-svcs-restore-003.png["螢幕截圖顯示了 GUI 中的此步驟。"]

. 從「作業監控」標籤中，您可以查看還原作業的狀態以及執行時的任何詳細資訊。


image:snapctr-svcs-restore-005.png["螢幕截圖顯示了 GUI 中的此步驟。"]

image:snapctr-svcs-restore-004.png["螢幕截圖顯示了 GUI 中的此步驟。"]

====


=== Oracle 資料庫克隆

[%collapsible%open]
====
若要複製資料庫，請從相同資料庫備份詳細資料頁面啟動複製工作流程。

. 選擇正確的資料庫備份副本，點擊三個點查看選單，然後選擇*克隆*選項。


image:snapctr-svcs-clone-002.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 如果您不需要變更任何複製資料庫參數，請選擇「*基本*」選項。


image:snapctr-svcs-clone-003.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 或者，選擇*規範檔案*，它為您提供了下載當前初始化檔案、進行更改然後將其上傳回作業的選項。


image:snapctr-svcs-clone-003-a.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 審查並啟動該工作。


image:snapctr-svcs-clone-004.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 從「*作業監控*」標籤監控複製作業狀態。


image:snapctr-svcs-clone-007-status.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 驗證 EC2 執行個體主機上的克隆資料庫。


image:snapctr-svcs-clone-008-crs.png["此圖顯示輸入/輸出對話框或表示書面內容"]

image:snapctr-svcs-clone-008-db.png["此圖顯示輸入/輸出對話框或表示書面內容"]

====


== 附加資訊

要了解有關本文檔中描述的信息的更多信息，請查看以下文檔和/或網站：

* 設定和管理BlueXP


link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html["https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html"^]

* BlueXP backup and recovery文檔


link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html["https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html"^]

* Amazon FSx ONTAP


link:https://aws.amazon.com/fsx/netapp-ontap/["https://aws.amazon.com/fsx/netapp-ontap/"^]

* 亞馬遜 EC2


link:https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2["https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2"^]
